var U=Object.defineProperty;var V=(e,t,n)=>t in e?U(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var F=(e,t,n)=>V(e,typeof t!="symbol"?t+"":t,n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();class B{constructor(t){F(this,"poem");this.poem=t}getHintLetters(){return this.poem.split(/\r?\n/).map(t=>t.trim()===""?"":t.trim().split(/\s+/).map(o=>{var s;const r=(s=o.match(/[a-zA-Z]/))==null?void 0:s[0];return r?r.toLowerCase():""}).join(" ")).join(`
`)}getHintLettersWithoutSpaces(){return this.poem.split(/\r?\n/).map(t=>t.trim()===""?"":t.trim().split(/\s+/).map(o=>{var s;const r=(s=o.match(/[a-zA-Z]/))==null?void 0:s[0];return r?r.toLowerCase():""}).join("")).join(`
`)}getLyrics(){return this.poem}getMarkup(){const t=this.poem.split(/\r?\n/),n=[],o=[];let r=0;for(const s of t){if(s.trim()===""){o.push({hints:"",lyric:""});continue}const c=s.trim().split(/\s+/).map(d=>{var m;const l=(m=d.match(/[a-zA-Z]/))==null?void 0:m[0];return l?l.toLowerCase():""}).join("");o.push({hints:c,lyric:s.trim()}),c.length>r&&(r=c.length)}for(const{hints:s,lyric:i}of o){if(i===""){n.push("");continue}const c=r-s.length+2,d=" ".repeat(c);n.push(s+d+i)}return n.join(`
`)}getOneAfterOther(){const t=this.poem.split(/\r?\n/),n=[];return t.forEach(o=>{if(o.trim()!==""){const s=o.trim().split(/\s+/).map(i=>{var d;const c=(d=i.match(/[a-zA-Z]/))==null?void 0:d[0];return c?c.toLowerCase():""}).join(" ");n.push(s)}else n.push("")}),this.poem+`

`+n.join(`
`)}getAnkiCloze(){const t=this.poem.split(/\n\s*\n/),n=[];return t.forEach((o,r)=>{if(o.trim()==="")return;const s=o.split(/\n/).filter(m=>m.trim()!==""),i=s.join(`
`),c=s.map(m=>m.trim().split(/\s+/).map(f=>{var p;const h=(p=f.match(/[a-zA-Z]/))==null?void 0:p[0];return h?h.toLowerCase():""}).join("")).join(`
`),l=`{{c${r+1}::${i}
::
${c}
}}`;n.push(l)}),n.join(`

`)}}const q=20,M="memorize-poems-saved",a=document.querySelector("#poemInput"),y=document.querySelector("#titleInput"),x=document.querySelector("#fontScale"),A=document.querySelector("#fontScaleNumber"),T=document.querySelector("#lineHeight"),H=document.querySelector("#lineHeightNumber"),X=document.querySelector("#printButton"),Q=document.querySelector("#saveButton"),W=document.querySelector("#ankiClozeButton"),Y=document.querySelector("#copyHintButton"),D=document.querySelector("#copyHintNoSpacesButton"),R=document.querySelector("#copyLyricsButton"),Z=document.querySelector("#copyLineByLineButton"),G=document.querySelector("#copyOneAfterOtherButton"),ee=document.querySelector("#poemForm"),g=document.querySelector("#poemGrid"),E=document.querySelector("#poemTitle"),J=document.querySelector("#contentInfo"),te=document.querySelector("#menuButton"),ne=document.querySelector("#helpButton"),k=document.querySelector("#savedPoemsMenu"),I=document.querySelector("#helpPopup"),oe=document.querySelector("#closeMenuButton"),re=document.querySelector("#closeHelpButton"),P=document.querySelector("#savedPoemsList"),se=document.querySelector("#cutNewlinesButton");let v=[];function ie(e,t){const n=t*.55,o=7.5*96,s=e.trim().split(/\s+/).length*t*.8,i=t*1.5,c=o-s-i,d=Math.floor(c/n),l=e.trim().split(/\s+/);if(l.length===0)return[];if(e.length<=d)return[e.trim()];const m=[];let u=l[0];for(let f=1;f<l.length;f++){const h=l[f],p=u+" "+h;p.length>d&&u.length>0?(m.push(u),u=h):u=p}return u&&m.push(u),m}async function C(e,t,n=!1){try{if(n&&navigator.clipboard.write){const s=`<pre style="font-family: 'Courier New', Consolas, monospace;">${t.replace(/\n/g,"<br>")}</pre>`,i=new ClipboardItem({"text/html":new Blob([s],{type:"text/html"}),"text/plain":new Blob([t],{type:"text/plain"})});await navigator.clipboard.write([i])}else await navigator.clipboard.writeText(t);const o=e.textContent,r=e.style.backgroundColor;e.textContent="Copied!",e.style.backgroundColor="#4CAF50",setTimeout(()=>{e.textContent=o,e.style.backgroundColor=r},2e3)}catch(o){console.error("Failed to copy text: ",o),alert("Failed to copy to clipboard")}}function O(e,t){const n=[],o=[];let r=0;t.trim()&&(n.push(r++),o.push(1));const s=e.split(/\n\s*\n/);for(let i=0;i<s.length-1;i++)n.push(r++),o.push(1);return console.log("Detected break areas:",n,"with spacing:",o),console.log("Stanza sections:",s.length),{areas:n,spacing:o}}function K(e,t){const n=document.createElement("div");n.className="configurable-break-area",n.dataset.areaId=e.toString();const o=document.createElement("div");o.className="break-controls";const r=document.createElement("button");r.className="break-control-btn",r.textContent="+",r.onclick=()=>_(e,1);const s=document.createElement("button");s.className="break-control-btn",s.textContent="−",s.onclick=()=>_(e,-1),o.appendChild(r),o.appendChild(s),n.appendChild(o),g.appendChild(n);for(let i=0;i<t;i++){const c=document.createElement("div");c.className="break-area-spacer",c.innerHTML="&nbsp;",g.appendChild(c)}}function _(e,t){console.log(`Adjusting break area ${e} by ${t}`);const n=v[e]??1,o=Math.max(0,Math.min(8,n+t));console.log(`Break area ${e}: ${n} -> ${o}`),v[e]=o,a.value&&L(a.value,y.value)}function L(e,t=""){g.innerHTML="",t.trim()?(E.textContent=t,E.style.display="block"):E.style.display="none";const n=parseInt(x.value)/100,o=16*n,r=parseFloat(T.value);g.style.fontSize=`${o}px`,g.style.lineHeight=r.toString();const s=O(e,t);v.length===0&&(v=[...s.spacing],console.log("Initialized break areas:",v));const i=e.split(/\r?\n/);let c=0,d=!1;if(t.trim()&&c<s.areas.length){const l=v[c]??1;K(c,l),c++}for(let l=0;l<i.length;l++){const m=i[l],u=m.trim()==="";if(!u&&!d)d=!0;else if(u&&d){if(d=!1,i.slice(l+1).some(p=>p.trim()!=="")&&c<s.areas.length){const p=v[c]??1;K(c,p),c++}continue}if(u)continue;const f=ie(m,o);for(const h of f){const p=h.trim().split(/\s+/),w=document.createElement("div");w.className="poemLine poemText",w.textContent=h;const b=document.createElement("div");b.className="poemLine hintText",b.textContent=p.map(S=>{var $;const N=($=S.match(/[a-zA-Z]/))==null?void 0:$[0];return N?N.toLowerCase():""}).join(" "),g.append(w,b)}}setTimeout(()=>{const l=g.offsetHeight,m=E.style.display!=="none"?E.offsetHeight:0,u=l+m,f=10*96,h=e.split(/\r?\n/).filter(S=>S.trim()!=="").length,w=g.querySelectorAll(".poemText").length-e.split(/\r?\n/).filter(S=>S.trim()==="").length-h,b=w>0;if(u>f){const S=Math.ceil(u/f),N=Math.floor(f/u*n*100);J.innerHTML=`
				<div style="color: #ffcc66;">⚠️ Fits on ${S} pages</div>
				<div>Try scale: ${N}%</div>
				<div style="color: ${b?"#ffcc66":"#99ff99"};">
					${b?`⚠️ ${w} lines broken`:"✓ No lines broken"}
				</div>
			`}else J.innerHTML=`
				<div style="color: #99ff99;">✓ Fits on one page</div>
				<div style="color: ${b?"#ffcc66":"#99ff99"};">
					${b?`⚠️ ${w} lines broken`:"✓ No lines broken"}
				</div>
			`},0)}function ae(e){let t=e.replace(/\n\n/g,`
`);return t=t.replace(/\n{2,}/g,`

`),t}a.value=`If we didn't have birthdays, you wouldn't be you.
If you’d never been born, well then what would you do?
If you’d never been born, well then what would you be?
You might be a fish! Or a toad in a tree!

You might be a doorknob! Or three baked potatoes!
You might be a bag full of hard green tomatoes.
Or worse than all that… Why, you might be a WASN’T!
A Wasn’t has no fun at all. No, he doesn’t.
A Wasn’t just isn’t. He just isn’t present.
But you…You ARE YOU! And, now isn’t that pleasant!

Today you are you! That is truer than true!
There is no one alive who is you-er than you!
Shout loud, “I am lucky to be what I am!
Thank goodness I’m not just a clam or a ham
Or a dusty old jar of sour gooseberry jam!
I am what I am! That’s a great thing to be!
If I say so myself, HAPPY BIRTHDAY TO ME!"`;x.addEventListener("input",()=>{A.value=x.value,a.value&&L(a.value,y.value)});T.addEventListener("input",()=>{H.value=T.value,a.value&&L(a.value,y.value)});H.addEventListener("input",()=>{const e=Math.max(1,parseFloat(H.value)||1.4);H.value=e.toString(),e<=8&&(T.value=e.toString()),a.value&&L(a.value,y.value)});A.addEventListener("input",()=>{const e=Math.min(150,Math.max(60,parseInt(A.value)||100));A.value=e.toString(),x.value=e.toString(),a.value&&L(a.value,y.value)});X.addEventListener("click",()=>{window.print()});a.addEventListener("input",()=>{v=[],a.value&&L(a.value,y.value)});y.addEventListener("input",()=>{a.value&&L(a.value,y.value)});a.addEventListener("keydown",e=>{e.key==="Enter"&&e.ctrlKey&&(e.preventDefault(),ee.requestSubmit())});function ce(e){const n=(e.split(`
`)[0]||"").trim();if(n.length<=q)return n;const o=n.lastIndexOf(" ",q);return o>0?n.substring(0,o)+"...":n.substring(0,q)+"..."}function j(){try{const e=localStorage.getItem(M);if(!e)return[];const t=JSON.parse(e);return Array.isArray(t)?t.filter(n=>{if(typeof n!="object"||!n)return console.warn("Invalid poem object:",n),!1;if(typeof n.title!="string"||typeof n.poemText!="string"||typeof n.fontScale!="number")return console.warn("Invalid poem properties:",n),!1;if(n.lineHeight===void 0&&(n.lineHeight=1.4),!n.configureableBreakAreas){const o=O(n.poemText,n.title);n.configureableBreakAreas=[...o.spacing]}return!0}):(console.warn("Invalid saved poems format, expected array"),[])}catch(e){return console.warn("Error loading saved poems:",e),[]}}function le(){const e=a.value.trim();if(!e)return;const t=y.value.trim()||ce(e),n=parseInt(x.value),o=parseFloat(T.value),r=j(),s={title:t,poemText:e,fontScale:n,lineHeight:o,configureableBreakAreas:[...v]},i=r.findIndex(c=>c.title===t);i>=0?r[i]=s:r.push(s),localStorage.setItem(M,JSON.stringify(r)),z()}function ue(e){y.value=e.title,a.value=e.poemText,x.value=e.fontScale.toString(),A.value=e.fontScale.toString(),T.value=(e.lineHeight||1.4).toString(),H.value=(e.lineHeight||1.4).toString(),e.configureableBreakAreas?v=[...e.configureableBreakAreas]:v=[...O(e.poemText,e.title).spacing],L(e.poemText,e.title),k.classList.remove("open")}function de(e){const n=j().filter(o=>o.title!==e);localStorage.setItem(M,JSON.stringify(n)),z()}function z(){const e=j();if(e.length===0){P.innerHTML='<p class="no-poems">No saved poems yet</p>';return}P.innerHTML="",e.forEach(t=>{const n=document.createElement("div");n.className="saved-poem-item";const o=document.createElement("button");o.className="saved-poem-title",o.textContent=t.title,o.onclick=()=>ue(t);const r=document.createElement("button");r.className="delete-poem-button",r.textContent="×",r.title="Delete poem",r.onclick=s=>{s.stopPropagation(),confirm(`Delete "${t.title}"?`)&&de(t.title)},n.appendChild(o),n.appendChild(r),P.appendChild(n)})}te.addEventListener("click",()=>{z(),k.classList.add("open")});oe.addEventListener("click",()=>{k.classList.remove("open")});ne.addEventListener("click",()=>{I.classList.add("open")});re.addEventListener("click",()=>{I.classList.remove("open")});k.addEventListener("click",e=>{e.target===k&&k.classList.remove("open")});I.addEventListener("click",e=>{e.target===I&&I.classList.remove("open")});Q.addEventListener("click",le);W.addEventListener("click",async()=>{const e=a.value.trim();if(!e)return;const t=new B(e);await C(W,t.getAnkiCloze())});Y.addEventListener("click",async()=>{const e=a.value.trim();if(!e)return;const t=new B(e);await C(Y,t.getHintLetters())});D.addEventListener("click",async()=>{const e=a.value.trim();if(!e)return;const t=new B(e);await C(D,t.getHintLettersWithoutSpaces())});R.addEventListener("click",async()=>{const e=a.value.trim();if(!e)return;const t=new B(e);await C(R,t.getLyrics())});Z.addEventListener("click",async()=>{const e=a.value.trim();if(!e)return;const t=new B(e);await C(Z,t.getMarkup(),!0)});G.addEventListener("click",async()=>{const e=a.value.trim();if(!e)return;const t=new B(e);await C(G,t.getOneAfterOther())});se.addEventListener("click",()=>{const e=a.value,t=ae(e);a.value=t,t&&L(t,y.value)});g.addEventListener("dblclick",e=>{const t=e.target;if(!t.classList.contains("poemText")&&!t.classList.contains("hintText"))return;e.preventDefault();const o=t.classList.contains("poemText")?Array.from(g.querySelectorAll(".poemText")):Array.from(g.querySelectorAll(".hintText")),r=o.map(i=>i.textContent||"").join(`
`),s=window.getSelection();if(s){s.removeAllRanges();const i=document.createRange();o.length>0&&(i.setStartBefore(o[0]),i.setEndAfter(o[o.length-1]),s.addRange(i))}navigator.clipboard.writeText(r).catch(i=>{console.error("Failed to copy text: ",i)})});L(a.value);
